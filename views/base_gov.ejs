<!DOCTYPE html>
<html lang="pt-pt">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="base_gov.css">
    <!-- Include Lucide icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <title>Helpdesk Público</title>
</head>

<body>
    <!-- Inclui o ficheiro nav.ejs -->
    <%- include('components/nav') %>

        <main class="container py-8">
            <div class="banner">
                <p>
                    Bem-vindo! O Helpdesk Público centraliza o apoio e informações sobre serviços públicos,
                    facilitando a comunicação e resolução de questões relacionadas com a administração pública em
                    Portugal.
                </p>
            </div>

            <div class="search-container">
                <div class="search-row">
                    <!-- Dropdown -->
                    <div class="dropdown" id="contracts-dropdown">
                        <button id="dropdown-button" class="dropdown-select" aria-haspopup="true" aria-expanded="false">
                            <span class="dropdown-text" id="selected-contract">Contratos</span>
                            <i data-lucide="chevron-down" class="dropdown-icon"></i>
                        </button>

                        <div class="dropdown-menu" id="dropdown-menu">
                            <div class="dropdown-item" data-value="Anúncios">Anúncios</div>
                            <div class="dropdown-item" data-value="Entidades">Entidades</div>
                            <div class="dropdown-item" data-value="Modificações contratuais">Modificações contratuais
                            </div>
                            <div class="dropdown-item" data-value="Bens móveis">Bens móveis</div>
                            <div class="dropdown-item" data-value="Não Celebrações de contrato">Não Celebrações de
                                contrato</div>
                            <div class="dropdown-item" data-value="Impugnação">Impugnação</div>
                        </div>
                    </div>

                    <!-- Search Input -->
                    <input type="text" placeholder="Pesquisar pelo objeto do Contrato" class="search-input" />

                    <!-- Search Button -->
                    <button class="search-button">
                        <i data-lucide="search" class="icon-small"></i>
                        <span>Pesquisar</span>
                    </button>

                    <!-- Advanced Search Button -->
                    <button id="advanced-search-btn" class="advanced-search-button">
                        <i data-lucide="sliders-horizontal" class="icon-small"></i>
                        <span>Pesquisa Avanc.</span>
                    </button>
                </div>

                <!-- Advanced Search Form -->
                <div id="advanced-search-form" class="advanced-search-form">
                    <div class="form-content">
                        <!-- First Row -->
                        <div class="form-row">
                            <div class="form-group">
                                <input type="checkbox" id="special-measures" class="form-checkbox" />
                                <label for="special-measures" class="form-label">
                                    Medidas especiais
                                </label>
                            </div>

                            <div class="form-group">
                                <input type="checkbox" id="include-mec" class="form-checkbox" />
                                <label for="include-mec" class="form-label">
                                    Incluir MEC ao abrigo do CCP
                                </label>
                            </div>

                            <div class="form-field">
                                <label for="measure-type" class="form-label">
                                    Tipologia da medida especial
                                </label>
                                <select id="measure-type" class="form-select">
                                    <option>Todos</option>
                                    <option>Opção 1</option>
                                    <option>Opção 2</option>
                                </select>
                            </div>
                        </div>

                        <hr class="form-divider" />

                        <!-- Second Row -->
                        <div class="form-row">
                            <div class="form-field">
                                <label for="procedure-type" class="form-label">
                                    Tipo de Procedimento
                                </label>
                                <select id="procedure-type" class="form-select">
                                    <option value="0">Todos</option>
                                    <option value="8">Consulta Prévia</option>
                                    <option value="1">Ajuste Direto Regime Geral</option>
                                    <option value="2">Concurso público</option>
                                    <option value="3">Concurso limitado por prévia qualificação</option>
                                    <option value="4">Procedimento de negociação</option>
                                    <option value="5">Diálogo concorrencial</option>
                                    <option value="6">Ao abrigo de acordo-quadro (art.º 258.º)</option>
                                    <option value="7">Ao abrigo de acordo-quadro (art.º 259.º)</option>
                                    <option value="9">Parceria para a inovação</option>
                                    <option value="10">Disponibilização de bens móveis</option>
                                    <option value="11">Serviços sociais e outros serviços específicos</option>
                                    <option value="13">Concurso de conceção simplificado</option>
                                    <option value="14">Concurso de ideias simplificado</option>
                                    <option value="15">Consulta Prévia Simplificada</option>
                                    <option value="16">Concurso público simplificado</option>
                                    <option value="17">Concurso limitado por prévia qualificação simplificado</option>
                                    <option value="18">Ajuste Direto Regime Geral ao abrigo do artigo 7º da Lei n.º
                                        30/2021, de 21.05</option>
                                    <option value="19">Consulta prévia ao abrigo do artigo 7º da Lei n.º 30/2021, de
                                        21.05</option>
                                    <option value="20">Ajuste direto simplificado</option>
                                    <option value="21">Ajuste direto simplificado ao abrigo da Lei n.º 30/2021, de 21.05
                                    </option>
                                    <option value="22">Setores especiais – isenção parte II</option>
                                    <option value="23">Contratação excluída II</option>
                                </select>
                            </div>

                            <div class="form-field">
                                <label for="entity" class="form-label">
                                    Entidade Adjudicante
                                </label>
                                <input type="text" id="entity" class="form-input" />
                            </div>
                        </div>

                        <!-- Third Row -->
                        <div class="form-row">
                            <div class="form-field">
                                <label for="contract-type" class="form-label">
                                    Tipo de Contrato
                                </label>
                                <select id="contract-type" class="form-select">
                                    <option value="0">Todos</option>
                                    <option value="1">Aquisição de bens móveis</option>
                                    <option value="2">Aquisição de serviços</option>
                                    <option value="3">Concessão de obras públicas</option>
                                    <option value="4">Concessão de serviços públicos</option>
                                    <option value="5">Empreitadas de obras públicas</option>
                                    <option value="6">Locação de bens móveis</option>
                                    <option value="7">Sociedade</option>
                                    <option value="8">Outros</option>
                                </select>
                            </div>

                            <div class="form-field">
                                <label for="awarded-entity" class="form-label">
                                    Entidade Adjudicatária
                                </label>
                                <input type="text" id="awarded-entity" class="form-input" />
                            </div>
                        </div>

                        <!-- Fourth Row -->
                        <div class="form-row">
                            <div class="form-field">
                                <label for="cpv" class="form-label">
                                    CPV
                                </label>
                                <input type="text" id="cpv" class="form-input" />
                            </div>

                            <div class="form-group">
                                <input type="checkbox" id="environmental-criteria" class="form-checkbox" />
                                <label for="environmental-criteria" class="form-label">
                                    Critérios ambientais
                                </label>
                            </div>
                        </div>

                        <!-- Fifth Row - Dates and Location -->
                        <div class="form-row">
                            <div class="form-field date-container">
                                <label for="date-type" class="form-label">
                                    Datas
                                </label>
                                <select id="date-type" class="form-select">
                                    <option>Data do Contrato</option>
                                    <option>Data de Publicação</option>
                                    <option>Data de Fecho</option>
                                </select>

                                <div class="date-range">
                                    <div class="date-field">
                                        <label for="date-from" class="form-label">
                                            De:
                                        </label>
                                        <div class="date-selects">
                                            <select class="date-select">
                                                <option>Ano:</option>
                                                <option>2023</option>
                                                <option>2022</option>
                                                <option>2021</option>
                                            </select>
                                            <select class="date-select">
                                                <option>Mês:</option>
                                                <option>01</option>
                                                <option>02</option>
                                                <option>03</option>
                                            </select>
                                            <select class="date-select">
                                                <option>Dia:</option>
                                                <option>01</option>
                                                <option>02</option>
                                                <option>03</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="date-field">
                                        <label for="date-to" class="form-label">
                                            Até:
                                        </label>
                                        <div class="date-selects">
                                            <select class="date-select">
                                                <option>Ano:</option>
                                                <option>2023</option>
                                                <option>2022</option>
                                                <option>2021</option>
                                            </select>
                                            <select class="date-select">
                                                <option>Mês:</option>
                                                <option>01</option>
                                                <option>02</option>
                                                <option>03</option>
                                            </select>
                                            <select class="date-select">
                                                <option>Dia:</option>
                                                <option>01</option>
                                                <option>02</option>
                                                <option>03</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="form-field location-container">
                                <label class="form-label">
                                    Local de Execução (País, Distrito, Concelho)
                                </label>
                                <select class="form-select location-select">
                                    <option>Todos</option>
                                    <option>Portugal</option>
                                    <option>Espanha</option>
                                </select>
                                <select class="form-select location-select">
                                    <option>Todos</option>
                                    <option>Lisboa</option>
                                    <option>Porto</option>
                                    <option>Faro</option>
                                </select>
                                <select class="form-select location-select">
                                    <option>Todos</option>
                                    <option>Lisboa</option>
                                    <option>Cascais</option>
                                    <option>Sintra</option>
                                </select>
                            </div>
                        </div>

                        <!-- Form Buttons -->
                        <div class="form-buttons">
                            <button id="clear-form-btn" class="clear-button">
                                <i data-lucide="x" class="icon-small"></i>
                                <span>LIMPAR</span>
                            </button>
                            <button class="submit-button">
                                <i data-lucide="search" class="icon-small"></i>
                                <span>PESQUISAR</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <%- include('components/tabela') %>
                <%- include('components/button') %>


        </main>
        <%- include('components/footer') %>

            <script>
                document.addEventListener('DOMContentLoaded', function () {
                    // Initialize Lucide icons
                    // Declare lucide if it's not already available globally
                    if (typeof lucide === 'undefined') {
                        console.warn('Lucide is not globally defined. Ensure Lucide library is properly included.');
                        // You might want to initialize a placeholder or load the library here if possible.
                        // Example placeholder:
                        lucide = { createIcons: function () { } };
                    }
                    lucide.createIcons();

                    // Dropdown functionality
                    const dropdownContainer = document.getElementById('contracts-dropdown');
                    const dropdownButton = document.getElementById('dropdown-button');
                    const dropdownText = document.getElementById('selected-contract');
                    const dropdownMenu = document.getElementById('dropdown-menu');
                    const dropdownItems = document.querySelectorAll('.dropdown-item');
                    const dropdownIcon = dropdownButton.querySelector('[data-lucide="chevron-down"]');

                    // Toggle dropdown menu when clicking on the button
                    dropdownButton.addEventListener('click', function (e) {
                        e.stopPropagation();
                        dropdownContainer.classList.toggle('active');

                        // Update ARIA attributes
                        const isExpanded = dropdownContainer.classList.contains('active');
                        dropdownButton.setAttribute('aria-expanded', isExpanded ? 'true' : 'false');
                    });

                    // Close dropdown when clicking outside
                    document.addEventListener('click', function () {
                        dropdownContainer.classList.remove('active');
                        dropdownButton.setAttribute('aria-expanded', 'false');
                    });

                    // Prevent closing when clicking inside the dropdown menu
                    dropdownMenu.addEventListener('click', function (e) {
                        e.stopPropagation();
                    });

                    // Select dropdown item
                    dropdownItems.forEach(function (item) {
                        item.addEventListener('click', function () {
                            const value = this.getAttribute('data-value');
                            dropdownText.textContent = value;
                            dropdownContainer.classList.remove('active');
                            dropdownButton.setAttribute('aria-expanded', 'false');

                            // You could trigger an action here based on selection
                            console.log('Selected:', value);
                        });
                    });

                    // Close dropdown when pressing Escape key
                    document.addEventListener('keydown', function (e) {
                        if (e.key === 'Escape') {
                            dropdownContainer.classList.remove('active');
                            dropdownButton.setAttribute('aria-expanded', 'false');
                        }
                    });

                    // Advanced Search Form functionality
                    const advancedSearchBtn = document.getElementById('advanced-search-btn');
                    const advancedSearchForm = document.getElementById('advanced-search-form');

                    advancedSearchBtn.addEventListener('click', function () {
                        advancedSearchForm.classList.toggle('visible');

                        // Scroll to form if it's now visible
                        if (advancedSearchForm.classList.contains('visible')) {
                            setTimeout(function () {
                                advancedSearchForm.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                            }, 100);
                        }
                    });

                    // Clear button functionality
                    const clearBtn = document.getElementById('clear-form-btn');

                    clearBtn.addEventListener('click', function () {
                        // Reset all form inputs
                        const inputs = advancedSearchForm.querySelectorAll('input');
                        const selects = advancedSearchForm.querySelectorAll('select');

                        inputs.forEach(function (input) {
                            if (input.type === 'checkbox') {
                                input.checked = false;
                            } else {
                                input.value = '';
                            }
                        });

                        selects.forEach(function (select) {
                            select.selectedIndex = 0;
                        });
                    });

                    // Search button functionality
                    const searchBtn = document.querySelector('.submit-button');

                    searchBtn.addEventListener('click', function () {
                        // Collect form data and submit
                        console.log('Advanced search submitted');
                        // Here you would typically collect all form data and submit it

                        // Example of collecting form data
                        const formData = {
                            specialMeasures: document.getElementById('special-measures').checked,
                            includeMec: document.getElementById('include-mec').checked,
                            measureType: document.getElementById('measure-type').value,
                            procedureType: document.getElementById('procedure-type').value,
                            entity: document.getElementById('entity').value,
                            contractType: document.getElementById('contract-type').value,
                            awardedEntity: document.getElementById('awarded-entity').value,
                            cpv: document.getElementById('cpv').value,
                            environmentalCriteria: document.getElementById('environmental-criteria').checked,
                            dateType: document.getElementById('date-type').value,
                            // Add more fields as needed
                        };

                        console.log('Form data:', formData);
                    });

                    // Make dropdown accessible via keyboard
                    dropdownButton.addEventListener('keydown', function (e) {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            dropdownContainer.classList.toggle('active');

                            const isExpanded = dropdownContainer.classList.contains('active');
                            dropdownButton.setAttribute('aria-expanded', isExpanded ? 'true' : 'false');
                        }
                    });
                });

                document.addEventListener('DOMContentLoaded', function () {
                    const searchButtons = document.querySelectorAll('.search-button, .submit-button'); // Seleciona ambos os botões
                    const resultsTable = document.getElementById('results-table');

                    searchButtons.forEach(button => {
                        button.addEventListener('click', function () {
                            // Exibe a tabela
                            resultsTable.style.display = 'block';

                            // Opcional: Role até a tabela
                            resultsTable.scrollIntoView({ behavior: 'smooth' });
                        });
                    });
                });
            </script>
</body>

</html>