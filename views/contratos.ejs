<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pesquisa Contratos - Helpdesk</title>
    <link rel="stylesheet" href="/css/contratos.css">
</head>
<body>
    <div class="container">
        <!-- Banner Section -->
        <div class="banner">
            <p>Bem-vindo! O Helpdesk Público centraliza o apoio e informações sobre serviços públicos, facilitando a comunicação e resolução de questões relacionadas com a administração pública em Portugal.</p>
        </div>

        <!-- Search Section -->
        <div class="search-container">
            <div class="search-header">
                <h1>PESQUISA</h1>
                <h2>Contratos</h2>
                <p class="update-info">Última atualização: <%= new Date().toLocaleDateString('pt-PT', {day: '2-digit', month: 'short', year: 'numeric'}) %></p>
            </div>

            <!-- Search Form -->
            <div class="search-form">
                <form id="contratosForm" action="/contratos" method="GET">
                    <div class="form-row">
                        <div class="select-container">
                            <select name="tipo" id="tipoContrato">
                                <option value="" selected>Todos os Contratos</option>
                                <option value="ajuste-direto" <%= locals.tipo === 'ajuste-direto' ? 'selected' : '' %>>Ajuste Direto</option>
                                <option value="consulta-previa" <%= locals.tipo === 'consulta-previa' ? 'selected' : '' %>>Consulta Prévia</option>
                                <option value="concurso-publico" <%= locals.tipo === 'concurso-publico' ? 'selected' : '' %>>Concurso Público</option>
                            </select>
                        </div>
                        <div class="input-container">
                            <input type="text" name="query" id="queryInput" placeholder="Pesquisar pelo objeto do Contrato" value="<%= locals.query || '' %>">
                        </div>
                        <div class="button-container">
                            <button type="submit" class="search-button">
                                <span class="search-icon">⌕</span>
                                Pesquisar
                            </button>
                        </div>
                        <div class="advanced-search">
                            <a href="#" id="advancedSearchLink">
                                <span class="advanced-icon">⚙</span>
                                Pesquisa Avanç.
                            </a>
                        </div>
                    </div>

                    <div class="advanced-options" id="advancedOptions" style="display: none;">
                        <div class="form-row">
                            <div class="input-group">
                                <label for="contractId">ID do Contrato</label>
                                <input type="text" name="contractId" id="contractId" value="<%= locals.contractId || '' %>">
                            </div>
                            <div class="input-group">
                                <label for="clientName">Nome do Cliente</label>
                                <input type="text" name="clientName" id="clientName" value="<%= locals.clientName || '' %>">
                            </div>
                            <div class="input-group">
                                <label for="dateFrom">Data Início</label>
                                <input type="date" name="dateFrom" id="dateFrom" value="<%= locals.dateFrom || '' %>">
                            </div>
                            <div class="input-group">
                                <label for="dateTo">Data Fim</label>
                                <input type="date" name="dateTo" id="dateTo" value="<%= locals.dateTo || '' %>">
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Results Section (only shown when results exist) -->
            <% if (locals.contratos && locals.contratos.length > 0) { %>
                <div class="results-info">
                    <div class="info-box">
                        <span class="info-icon">ℹ</span> Número de resultados: <%= locals.contratos.length %>
                    </div>
                    <div class="export-button">
                        <a href="#" id="exportResults">
                            <span class="download-icon">↓</span> EXPORTAR RESULTADOS (ATÉ 500 LINHAS)
                        </a>
                    </div>
                </div>

                <h3 class="results-title">Resultados da pesquisa</h3>

                <div class="results-table-container">
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th class="sortable" data-sort="objeto">Objeto do contrato <span class="sort-icon">↕</span></th>
                                <th>Tipo de procedimento</th>
                                <th>Adjudicante</th>
                                <th>Adjudicatário</th>
                                <th class="sortable" data-sort="preco">Preço contratual <span class="sort-icon">↕</span></th>
                                <th class="sortable" data-sort="data">Publicação <span class="sort-icon">↕</span></th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            <% locals.contratos.forEach(contrato => { %>
                                <tr>
                                    <td><%= contrato.objeto %></td>
                                    <td><%= contrato.tipoProcedimento %></td>
                                    <td><%= contrato.adjudicante %></td>
                                    <td><%= contrato.adjudicatario %></td>
                                    <td><%= contrato.preco.toLocaleString('pt-PT') %> €</td>
                                    <td><%= new Date(contrato.dataPublicacao).toLocaleDateString('pt-PT', {day: '2-digit', month: '2-digit', year: 'numeric'}) %></td>
                                    <td>
                                        <a href="/contratos/<%= contrato.id %>" class="details-button">
                                            <span class="plus-icon">+</span>
                                        </a>
                                    </td>
                                </tr>
                            <% }); %>
                        </tbody>
                    </table>
                </div>
            <% } %>
        </div>
    </div>
    <script src="/js/contratos.js"></script>
</body>
</html>